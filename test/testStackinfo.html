
<script src="../generatedBuild/stackinfo.umd.js"></script>
<script src="moar.js"></script>
<script>
    function A(asdf) {
        B(asdf)
    }
    
    function B(asdf) {
        C.call(this, asdf)
    }
    
    function C(asdf) {
        new D(asdf)
    }
    
    function D(asdf) {
        E.fn1(asdf)
    }
    
    var E = {
        fn1: function(asdf) {
            F[0][6]()(asdf)
        }
    }
    
    var F = [{
            6: function() {
                return function(asdf) {
                    G(asdf)
                }
            }
        }]
    
    var G = function(asdf) {
        ;[1].forEach(function() {
            H(asdf)  
        })  
    }
    
    var H = function() {
        moar(function() {
            var trace = stackinfo()
            console.log(trace.length+" items in trace")
            trace.forEach(function(v) {
                console.log(JSON.stringify(v.info))
            })
        })
    }

    A(23)

    function bench() {
        var t0 = Date.now()
        for(var n=0; n<1000; n++) {
            var trace = stackinfo()
        }

        return Date.now() - t0
    }
    function bench2() {
        var t0 = Date.now()
        for(var n=0; n<1000; n++) {
            var trace = stackinfo()
            var x = trace[0].line
        }

        return Date.now() - t0
    }

    console.log("Generation benchmark took "+bench()+"ms")
    console.log("Generation + parsing one line (benchmark 2) took "+bench2()+"ms")

    // traceline cases
    if(stackinfo.mode === 'chrome') {
        testTraceline("ProtoObjectFactory.<anonymous> (http://localhost:8001/git/frontend/test/allTestsFE.bundle.js:1459:20)")
        testTraceline("(?)()@http://localhost:8001/git/frontend/test/allTestsFE.bundle.js:79:15")
        testTraceline("Object.module.exports.test.TabBar.buttons.callback [as click] (http://localhost:8001/git/frontend/test/allTestsFE.bundle.js:1546:9)")
    } else if('firefox') {
        testTraceline("(?)()@http://localhost:8100/test.web.bundle.js:75")
    }


    // makes it easier to add cases - instead of having to reproduce an exception that creates such a traceline
    function testTraceline(line) {
        var result = stackinfo.parsers[stackinfo.mode](line)

        console.log(line+' - '+result.file+' '+result.function+' '+result.line+' '+result.column)
    }

</script>
